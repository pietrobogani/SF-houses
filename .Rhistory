i = i+1
}
measn = means/count
rent2011_temp[j,1]
length(rent2011_temp[,1])
j
means <- numeric(g)
i = 1
rent2011_temp <- rent_2011g
Levels.name1 <- factor(nhood)
for (ch in levels(Levels.name1)){
count = 0
means=0
for(j in 1:length(rent2011_temp[,1])){
if(rent2011_temp[j,1]==ch){
means[i] = means[i] + rent2011_temp[j,2]
count[i] = count[i]+1
}
}
i = i+1
}
measn = means/count
rent2011_temp[j,2]
means <- numeric(g)
count = numeric(length(levels(Levels.name1)))
means= numeric(length(levels(Levels.name1)))
i = 1
rent2011_temp <- rent_2011g
Levels.name1 <- factor(nhood)
for (ch in levels(Levels.name1)){
for(j in 1:length(rent2011_temp[,1])){
if(rent2011_temp[j,1]==ch){
means[i] = means[i] + rent2011_temp[j,2]
count[i] = count[i]+1
}
}
i = i+1
}
measn = means/count
measn
plot(measn, c(1:44))
plot(c(1:44),measn)
max(measn)
which.max(measn)
levels(Levels.name1)[which.max(measn)]
setwd("C:/Users/Pietro/Desktop/Pietro/Politecnico/Magistrale/Nonparametric_Statistics/Progetto/ricerca di progetti/Progetto Case SF/SF-houses")
rent_clean <- read.csv("C:/Users/Pietro/Desktop/Pietro/Politecnico/Magistrale/Nonparametric_Statistics/Progetto/ricerca di progetti/Progetto Case SF/SF-houses/rent_clean.csv", header=TRUE)
# ---------- 7) Permutational ANOVA on rent_clean grouping by NHOOD
#I need to choose the years to be considered, I need the ones with the most observations
length(rent_clean[rent_clean$V13 == '2001',15]) #5
length(rent_clean[rent_clean$V13 == '2002',15]) #6
length(rent_clean[rent_clean$V13 == '2003',15]) #7
length(rent_clean[rent_clean$V13 == '2004',15]) #250
length(rent_clean[rent_clean$V13 == '2005',15]) #28
length(rent_clean[rent_clean$V13 == '2006',15]) #67
length(rent_clean[rent_clean$V13 == '2007',15]) #24
length(rent_clean[rent_clean$V13 == '2008',15]) #8
length(rent_clean[rent_clean$V13 == '2009',15]) #5
length(rent_clean[rent_clean$V13 == '2010',15]) #6
length(rent_clean[rent_clean$V13 == '2011',15]) #1241    #Basandoci su 'rent_clean.csv', gli unici anni in cui studiare sono dal 2011 al 2018
length(rent_clean[rent_clean$V13 == '2012',15]) #2707
length(rent_clean[rent_clean$V13 == '2013',15]) #884
length(rent_clean[rent_clean$V13 == '2014',15]) #623
length(rent_clean[rent_clean$V13 == '2015',15]) #1587
length(rent_clean[rent_clean$V13 == '2016',15]) #2121
length(rent_clean[rent_clean$V13 == '2017',15]) #262
length(rent_clean[rent_clean$V13 == '2018',15]) #354
#I will keep only years s.t. 2010 < year < 2017
rent_temp <- rent_clean
rent_temp <- rent_temp[rent_temp$year > 2010 & rent_temp$year < 2017,]
# I will start by running 6 separate ANOVA, one for each year from 2011 to 2016
rent_2011 <- rent_temp[rent_temp$year == 2011,]
rent_2012 <- rent_temp[rent_temp$year == 2012,]
rent_2013 <- rent_temp[rent_temp$year == 2013,]
rent_2014 <- rent_temp[rent_temp$year == 2014,]
rent_2015 <- rent_temp[rent_temp$year == 2015,]
rent_2016 <- rent_temp[rent_temp$year == 2016,]
#-- ANOVA on year = 2011
attach(rent_2011)
Levels.name <- factor(nhood, labels=c(1:44))
treat   <- levels(Levels.name)      # levels of the treatment
g       <- length(treat)    # 44 nhoods
B = 1000
seed = 26111992
rent_2011g = rent_2011[,c(3,11)]
i <- numeric(g)
nn <- numeric(g)
for (j in 1:g){
i <- which(Levels.name==j)
nn[j] = length(i)
}
n  <- sum(nn) #1241
plot(Levels.name, price_mq, xlab='treat',col=rainbow(g),main='Original Data') # boxplot dei vari nhood nell anno 2011
fit <- aov(price_mq ~ Levels.name)
summary(fit)
T0 <- summary(fit)[[1]][1,4] #F-value of Levels
T0
T_stat <- numeric(B)
for(perm in 1:B){
# Permutation:
permutation <- sample(1:n)
covariate_perm <- price_mq[permutation]
fit_perm <- aov(covariate_perm ~ Levels.name)
# Test statistic:
T_stat[perm] <- summary(fit_perm)[[1]][1,4]
}
hist(T_stat,xlim=range(c(T_stat,T0)),breaks=30)
abline(v=T0,col=3,lwd=2)
plot(ecdf(T_stat),xlim=c(-1,30))
abline(v=T0,col=3,lwd=4)
# p-value
p_val <- sum(T_stat>=T0)/B
p_val
#-- p-value 0. Ci sono nhood diversi. Troviamoli
means <- numeric(g)
count = numeric(length(levels(Levels.name1)))
means= numeric(length(levels(Levels.name1)))
i = 1
rent2011_temp <- rent_2011g
Levels.name1 <- factor(nhood)
for (ch in levels(Levels.name1)){
for(j in 1:length(rent2011_temp[,1])){
if(rent2011_temp[j,1]==ch){
means[i] = means[i] + rent2011_temp[j,2]
count[i] = count[i]+1
}
}
i = i+1
}
measn = means/count
plot(c(1:44),measn) #sembra uno solo sia fuori scala!
which.max(measn) #12esimo è quello fuori scala
levels(Levels.name1)[which.max(measn)]                # financial district è quello che sembra fuori scala. togliamolo
rent_clean <- read.csv("C:/Users/Pietro/Desktop/Pietro/Politecnico/Magistrale/Nonparametric_Statistics/Progetto/ricerca di progetti/Progetto Case SF/SF-houses/rent_clean.csv", header=TRUE)
# ---------- 7) Permutational ANOVA on rent_clean grouping by NHOOD
#I need to choose the years to be considered, I need the ones with the most observations
length(rent_clean[rent_clean$V13 == '2001',15]) #5
length(rent_clean[rent_clean$V13 == '2002',15]) #6
length(rent_clean[rent_clean$V13 == '2003',15]) #7
length(rent_clean[rent_clean$V13 == '2004',15]) #250
length(rent_clean[rent_clean$V13 == '2005',15]) #28
length(rent_clean[rent_clean$V13 == '2006',15]) #67
length(rent_clean[rent_clean$V13 == '2007',15]) #24
length(rent_clean[rent_clean$V13 == '2008',15]) #8
length(rent_clean[rent_clean$V13 == '2009',15]) #5
length(rent_clean[rent_clean$V13 == '2010',15]) #6
length(rent_clean[rent_clean$V13 == '2011',15]) #1241    #Basandoci su 'rent_clean.csv', gli unici anni in cui studiare sono dal 2011 al 2018
length(rent_clean[rent_clean$V13 == '2012',15]) #2707
length(rent_clean[rent_clean$V13 == '2013',15]) #884
length(rent_clean[rent_clean$V13 == '2014',15]) #623
length(rent_clean[rent_clean$V13 == '2015',15]) #1587
length(rent_clean[rent_clean$V13 == '2016',15]) #2121
length(rent_clean[rent_clean$V13 == '2017',15]) #262
length(rent_clean[rent_clean$V13 == '2018',15]) #354
#I will keep only years s.t. 2010 < year < 2017
rent_temp <- rent_clean
rent_temp <- rent_temp[rent_temp$year > 2010 & rent_temp$year < 2017,]
# I will start by running 6 separate ANOVA, one for each year from 2011 to 2016
rent_2011 <- rent_temp[rent_temp$year == 2011,]
rent_2012 <- rent_temp[rent_temp$year == 2012,]
rent_2013 <- rent_temp[rent_temp$year == 2013,]
rent_2014 <- rent_temp[rent_temp$year == 2014,]
rent_2015 <- rent_temp[rent_temp$year == 2015,]
rent_2016 <- rent_temp[rent_temp$year == 2016,]
#-- ANOVA on year = 2011
attach(rent_2011)
Levels.name <- factor(nhood, labels=c(1:44))
treat   <- levels(Levels.name)      # levels of the treatment
g       <- length(treat)    # 44 nhoods
B = 1000
seed = 26111992
rent_2011g = rent_2011[,c(3,11)]
i <- numeric(g)
nn <- numeric(g)
for (j in 1:g){
i <- which(Levels.name==j)
nn[j] = length(i)
}
n  <- sum(nn) #1241
plot(Levels.name, price_mq, xlab='treat',col=rainbow(g),main='Original Data') # boxplot dei vari nhood nell anno 2011
fit <- aov(price_mq ~ Levels.name)
summary(fit)
T0 <- summary(fit)[[1]][1,4] #F-value of Levels
T0
T_stat <- numeric(B)
for(perm in 1:B){
# Permutation:
permutation <- sample(1:n)
covariate_perm <- price_mq[permutation]
fit_perm <- aov(covariate_perm ~ Levels.name)
# Test statistic:
T_stat[perm] <- summary(fit_perm)[[1]][1,4]
}
hist(T_stat,xlim=range(c(T_stat,T0)),breaks=30)
abline(v=T0,col=3,lwd=2)
plot(ecdf(T_stat),xlim=c(-1,30))
abline(v=T0,col=3,lwd=4)
# p-value
p_val <- sum(T_stat>=T0)/B
p_val
#-- p-value 0. Ci sono nhood diversi. Troviamoli
means <- numeric(g)
Levels.name1 <- factor(nhood)
count = numeric(length(levels(Levels.name1)))
means= numeric(length(levels(Levels.name1)))
i = 1
rent2011_temp <- rent_2011g
for (ch in levels(Levels.name1)){
for(j in 1:length(rent2011_temp[,1])){
if(rent2011_temp[j,1]==ch){
means[i] = means[i] + rent2011_temp[j,2]
count[i] = count[i]+1
}
}
i = i+1
}
measn = means/count
plot(c(1:44),measn) #sembra uno solo sia fuori scala!
which.max(measn) #12esimo è quello fuori scala
levels(Levels.name1)[which.max(measn)]                # financial district è quello che sembra fuori scala. togliamolo
rent2011_temp[,1]
rent2011_temp <- rent2011_temp[which(rent2011_temp[,1]!="financial district"),]
View(rent2011_temp)
attach(rent2011_temp)
Levels.name2 <- factor(nhood, labels=c(1:43))
treat   <- levels(Levels.name2)      # levels of the treatment
g       <- length(treat)    # 43 nhoods
B = 1000
seed = 26111992
rent_2011g = rent2011_temp[,c(3,11)]
i <- numeric(g)
nn <- numeric(g)
for (j in 1:g){
i <- which(Levels.name2==j)
nn[j] = length(i)
}
n  <- sum(nn) #1241
attach(rent2011_temp)
Levels.name2 <- factor(nhood, labels=c(1:43))
treat   <- levels(Levels.name2)      # levels of the treatment
g       <- length(treat)    # 43 nhoods
B = 1000
seed = 26111992
rent_2011g = rent2011_temp[,c(3,11)]
i <- numeric(g)
nn <- numeric(g)
for (j in 1:g){
i <- which(Levels.name2==j)
nn[j] = length(i)
}
n  <- sum(nn) #1193
plot(Levels.name2, price_mq, xlab='treat',col=rainbow(g),main='Original Data') # boxplot dei vari nhood nell anno 2011
fit <- aov(price_mq ~ Levels.name2)
summary(fit)
T0 <- summary(fit)[[1]][1,4] #F-value of Levels
T0
T_stat <- numeric(B)
for(perm in 1:B){
# Permutation:
permutation <- sample(1:n)
covariate_perm <- price_mq[permutation]
fit_perm <- aov(covariate_perm ~ Levels.name2)
# Test statistic:
T_stat[perm] <- summary(fit_perm)[[1]][1,4]
}
hist(T_stat,xlim=range(c(T_stat,T0)),breaks=30)
abline(v=T0,col=3,lwd=2)
plot(ecdf(T_stat),xlim=c(-1,30))
abline(v=T0,col=3,lwd=4)
# p-value
p_val <- sum(T_stat>=T0)/B
p_val
plot(c(1:44),measn) #sembra uno solo sia fuori scala!
which.min(measn)
levels(Levels.name1)[which.min(measn)]
rent2011_temp <- rent2011_temp[which(rent2011_temp[,1]!="financial district") & which(rent2011_temp[,1]!="treasure island"),]
rent2011_temp <- rent2011_temp[which(rent2011_temp[,1]!="financial district" & rent2011_temp[,1]!="treasure island"),]
attach(rent2011_temp)
Levels.name2 <- factor(nhood, labels=c(1:42))
treat   <- levels(Levels.name2)      # levels of the treatment
g       <- length(treat)    # 42 nhoods
B = 1000
seed = 26111992
rent_2011g = rent2011_temp[,c(3,11)]
i <- numeric(g)
nn <- numeric(g)
for (j in 1:g){
i <- which(Levels.name2==j)
nn[j] = length(i)
}
n  <- sum(nn) #1192
plot(Levels.name2, price_mq, xlab='treat',col=rainbow(g),main='Original Data') # boxplot dei vari nhood nell anno 2011
fit <- aov(price_mq ~ Levels.name2)
summary(fit)
T0 <- summary(fit)[[1]][1,4] #F-value of Levels
T0
T_stat <- numeric(B)
for(perm in 1:B){
# Permutation:
permutation <- sample(1:n)
covariate_perm <- price_mq[permutation]
fit_perm <- aov(covariate_perm ~ Levels.name2)
# Test statistic:
T_stat[perm] <- summary(fit_perm)[[1]][1,4]
}
hist(T_stat,xlim=range(c(T_stat,T0)),breaks=30)
abline(v=T0,col=3,lwd=2)
plot(ecdf(T_stat),xlim=c(-1,30))
abline(v=T0,col=3,lwd=4)
# p-value
p_val <- sum(T_stat>=T0)/B
p_val
nn
Levels.name[5]
Levels.name
rent_clean <- read.csv("C:/Users/Pietro/Desktop/Pietro/Politecnico/Magistrale/Nonparametric_Statistics/Progetto/ricerca di progetti/Progetto Case SF/SF-houses/rent_clean.csv", header=TRUE)
# ---------- 7) Permutational ANOVA on rent_clean grouping by NHOOD
#I need to choose the years to be considered, I need the ones with the most observations
length(rent_clean[rent_clean$V13 == '2001',15]) #5
length(rent_clean[rent_clean$V13 == '2002',15]) #6
length(rent_clean[rent_clean$V13 == '2003',15]) #7
length(rent_clean[rent_clean$V13 == '2004',15]) #250
length(rent_clean[rent_clean$V13 == '2005',15]) #28
length(rent_clean[rent_clean$V13 == '2006',15]) #67
length(rent_clean[rent_clean$V13 == '2007',15]) #24
length(rent_clean[rent_clean$V13 == '2008',15]) #8
length(rent_clean[rent_clean$V13 == '2009',15]) #5
length(rent_clean[rent_clean$V13 == '2010',15]) #6
length(rent_clean[rent_clean$V13 == '2011',15]) #1241    #Basandoci su 'rent_clean.csv', gli unici anni in cui studiare sono dal 2011 al 2018
length(rent_clean[rent_clean$V13 == '2012',15]) #2707
length(rent_clean[rent_clean$V13 == '2013',15]) #884
length(rent_clean[rent_clean$V13 == '2014',15]) #623
length(rent_clean[rent_clean$V13 == '2015',15]) #1587
length(rent_clean[rent_clean$V13 == '2016',15]) #2121
length(rent_clean[rent_clean$V13 == '2017',15]) #262
length(rent_clean[rent_clean$V13 == '2018',15]) #354
#I will keep only years s.t. 2010 < year < 2017
rent_temp <- rent_clean
rent_temp <- rent_temp[rent_temp$year > 2010 & rent_temp$year < 2017,]
# I will start by running 6 separate ANOVA, one for each year from 2011 to 2016
rent_2011 <- rent_temp[rent_temp$year == 2011,]
rent_2012 <- rent_temp[rent_temp$year == 2012,]
rent_2013 <- rent_temp[rent_temp$year == 2013,]
rent_2014 <- rent_temp[rent_temp$year == 2014,]
rent_2015 <- rent_temp[rent_temp$year == 2015,]
rent_2016 <- rent_temp[rent_temp$year == 2016,]
#-- ANOVA on year = 2011
attach(rent_2011)
Levels.name <- factor(nhood, labels=c(1:44))
Levels.name1 <- factor(nhood)
treat   <- levels(Levels.name)      # levels of the treatment
g       <- length(treat)    # 44 nhoods
B = 1000
seed = 26111992
rent_2011g = rent_2011[,c(3,11)]
i <- numeric(g)
nn <- numeric(g)
for (j in 1:g){
i <- which(Levels.name==j)
nn[j] = length(i)
}
#I will remove nhood with less than 5 observations.
Levels.name1
treat
treat1   <- levels(Levels.name1)      # levels of the treatment
treat1
#I will remove nhood with less than 5 observations.
remove <- which(nn<5)
remove
nn
remove_nhood <- treat1(remove_index)
remove_nhood <- treat1[remove_index]
#I will remove nhood with less than 5 observations.
remove_index <- which(nn<5)
remove_nhood <- treat1[remove_index]
remove_nhood
which(rent_2011[,1]!=remove_nhood)
rent_2011[,1]
View(rent_2011)
rent_2011 <- rent_2011[which(rent_2011[,3]!=remove_nhood)]
rent_2011 <- rent_2011[which(rent_2011[,3]!=remove_nhood),]
remove_nhood
remove_nhood[1]
rent_2011 <- rent_2011[which(rent_2011[,3]!=remove_nhood[1] & rent_2011[,3]!=remove_nhood[2] & rent_2011[,3]!=remove_nhood[3] & rent_2011[,3]!=remove_nhood[4] & rent_2011[,3]!=remove_nhood[5] & rent_2011[,3]!=remove_nhood[6]),]
View(rent_2011)
#I will remove nhood with less than 5 observations.
remove_index <- which(nn<5)
remove_nhood <- treat1[remove_index]
rent_2011 <- rent_2011[which(rent_2011[,3]!=remove_nhood[1] & rent_2011[,3]!=remove_nhood[2] & rent_2011[,3]!=remove_nhood[3] & rent_2011[,3]!=remove_nhood[4] & rent_2011[,3]!=remove_nhood[5] & rent_2011[,3]!=remove_nhood[6]),]
rent_2011g = rent_2011[,c(3,11)]
i <- numeric(g)
nn <- numeric(g)
for (j in 1:g){
i <- which(Levels.name==j)
nn[j] = length(i)
}
n  <- sum(nn) #1241
Levels.name1 <- factor(rent_2011g$nhood)
Levels.name <- factor(rent_2011g$nhood, labels=c(1:38))
Levels.name1 <- factor(rent_2011g$nhood)
treat   <- levels(Levels.name)      # levels of the treatment
treat1   <- levels(Levels.name1)      # levels of the treatment
g       <- length(treat)    # 44 nhoods
i <- numeric(g)
nn <- numeric(g)
for (j in 1:g){
i <- which(Levels.name==j)
nn[j] = length(i)
}
n  <- sum(nn) #1241
plot(Levels.name, price_mq, xlab='treat',col=rainbow(g),main='Original Data') # boxplot dei vari nhood nell anno 2011
fit <- aov(price_mq ~ Levels.name)
summary(fit)
T0 <- summary(fit)[[1]][1,4] #F-value of Levels
T0
T_stat <- numeric(B)
for(perm in 1:B){
# Permutation:
permutation <- sample(1:n)
covariate_perm <- price_mq[permutation]
fit_perm <- aov(covariate_perm ~ Levels.name)
# Test statistic:
T_stat[perm] <- summary(fit_perm)[[1]][1,4]
}
hist(T_stat,xlim=range(c(T_stat,T0)),breaks=30)
abline(v=T0,col=3,lwd=2)
plot(ecdf(T_stat),xlim=c(-1,30))
abline(v=T0,col=3,lwd=4)
# p-value
p_val <- sum(T_stat>=T0)/B
p_val
plot(Levels.name, rent_2011g$price_mq, xlab='treat',col=rainbow(g),main='Original Data') # boxplot dei vari nhood nell anno 2011
fit <- aov(rent_2011g$price_mq ~ Levels.name)
summary(fit)
T0 <- summary(fit)[[1]][1,4] #F-value of Levels
T0
T_stat <- numeric(B)
for(perm in 1:B){
# Permutation:
permutation <- sample(1:n)
covariate_perm <- price_mq[permutation]
fit_perm <- aov(covariate_perm ~ Levels.name)
# Test statistic:
T_stat[perm] <- summary(fit_perm)[[1]][1,4]
}
hist(T_stat,xlim=range(c(T_stat,T0)),breaks=30)
abline(v=T0,col=3,lwd=2)
plot(ecdf(T_stat),xlim=c(-1,30))
abline(v=T0,col=3,lwd=4)
# p-value
p_val <- sum(T_stat>=T0)/B
p_val
means <- numeric(g)
count = numeric(length(levels(Levels.name1)))
means= numeric(length(levels(Levels.name1)))
i = 1
for (ch in levels(Levels.name1)){
for(j in 1:length(rent2011_temp[,1])){
if(rent2011_temp[j,1]==ch){
means[i] = means[i] + rent2011_temp[j,2]
count[i] = count[i]+1
}
}
i = i+1
}
measn = means/count
means <- numeric(g)
count = numeric(length(levels(Levels.name1)))
means= numeric(length(levels(Levels.name1)))
i = 1
for (ch in levels(Levels.name1)){
for(j in 1:length(rent2011_temp[,1])){
if(rent2011_temp[j,1]==ch){
means[i] = means[i] + rent_2011g[j,2]
count[i] = count[i]+1
}
}
i = i+1
}
measn = means/count
means <- numeric(g)
count = numeric(length(levels(Levels.name1)))
means= numeric(length(levels(Levels.name1)))
i = 1
for (ch in levels(Levels.name1)){
for(j in 1:length(rent_2011g[,1])){
if(rent2011_temp[j,1]==ch){
means[i] = means[i] + rent_2011g[j,2]
count[i] = count[i]+1
}
}
i = i+1
}
measn = means/count
means <- numeric(g)
count = numeric(length(levels(Levels.name1)))
means= numeric(length(levels(Levels.name1)))
i = 1
for (ch in levels(Levels.name1)){
for(j in 1:length(rent_2011g[,1])){
if(rent_2011g[j,1]==ch){
means[i] = means[i] + rent_2011g[j,2]
count[i] = count[i]+1
}
}
i = i+1
}
measn = means/count
plot(c(1:38),measn) #sembra uno solo sia fuori scala!
which.min(measn)
which.max(measn) #12esimo è quello fuori scala
levels(Levels.name1)[which.max(measn)]                # financial district è quello che sembra fuori scala verso l'alto. togliamolo
